{% extends "base.html" %}

{% block content %}
  <h1>Delete strategy: {{ spec_name }}</h1>

  <div style="margin: 12px 0; padding: 10px 12px; border: 1px solid #b45309; background: #fffbeb; border-radius: 8px;">
    <div style="font-weight: 700; margin-bottom: 6px;">This action is destructive.</div>
    <div style="opacity: 0.9;">
      By default, this deletes the spec and the compiled strategy folder (if recognized as generated), so it can be rebuilt later.
      Past runs, logs, and reports are kept.
    </div>
  </div>

  <h2 style="margin-top: 18px;">Will be deleted</h2>
  <div style="border: 1px solid #2b2b2b33; border-radius: 10px; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f3f4f6; text-align: left;">
          <th style="padding: 10px 12px; width: 220px;">Item</th>
          <th style="padding: 10px 12px;">Path</th>
          <th style="padding: 10px 12px; width: 120px;">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for t in delete_targets %}
          <tr style="border-top: 1px solid #2b2b2b22;">
            <td style="padding: 10px 12px; font-weight: 600;">{{ t.label }}</td>
            <td style="padding: 10px 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 12px;">
              {{ t.path }}
              {% if t.note %}
                <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; opacity: 0.8; font-size: 12px; margin-top: 4px;">
                  {{ t.note }}
                </div>
              {% endif %}
            </td>
            <td style="padding: 10px 12px;">
              {% if not t.exists %}
                <span style="opacity: 0.75;">Not found</span>
              {% else %}
                {% if t.label == 'Compiled strategy folder' %}
                  {% if compiled_is_generated %}
                    <span style="color: #b91c1c; font-weight: 700;">Will delete</span>
                  {% else %}
                    <span style="opacity: 0.85;">Will not delete</span>
                  {% endif %}
                {% else %}
                  <span style="color: #b91c1c; font-weight: 700;">Will delete</span>
                {% endif %}
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <h2 style="margin-top: 18px;">Will NOT be deleted</h2>
  <div style="border: 1px solid #2b2b2b33; border-radius: 10px; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f3f4f6; text-align: left;">
          <th style="padding: 10px 12px; width: 220px;">Item</th>
          <th style="padding: 10px 12px;">Path</th>
        </tr>
      </thead>
      <tbody>
        {% for t in will_not_delete %}
          <tr style="border-top: 1px solid #2b2b2b22;">
            <td style="padding: 10px 12px; font-weight: 600;">{{ t.label }}</td>
            <td style="padding: 10px 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 12px;">
              {{ t.path }}
              {% if t.note %}
                <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; opacity: 0.8; font-size: 12px; margin-top: 4px;">
                  {{ t.note }}
                </div>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <h2 style="margin-top: 18px;">Confirm</h2>

  <form method="post" action="/strategies/spec/{{ spec_name }}/delete" style="margin-top: 12px;">
    <div style="display:flex; gap: 10px; align-items:center; flex-wrap: wrap;">
      <input name="confirm_name" placeholder="Type: {{ spec_name }}" style="min-width: 260px; padding: 8px 10px;" />

      <label style="display:flex; gap:8px; align-items:center;">
        <input type="hidden" name="delete_compiled" value="0" />
        <input type="checkbox" name="delete_compiled" value="1" checked />
        Delete compiled folder (if generated)
      </label>

      <button type="submit" class="button-danger" style="margin-top: 0;">
        Permanently delete
      </button>

      <a class="button" href="/strategies/spec/{{ spec_name }}" style="margin-top: 0;">
        Cancel
      </a>
    </div>

    {% if compiled_exists and not compiled_is_generated %}
      <div style="margin-top: 10px; opacity: 0.9;">
        Note: compiled folder exists but is not recognized as generated, so it will be preserved.
      </div>
    {% endif %}
  </form>
{% endblock %}
